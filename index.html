<script>
let carrinho = [];
let usuarioLogado = JSON.parse(localStorage.getItem("usuario")) || null;

/* ===== BUSCA ===== */
function buscar() {
    let texto = document.getElementById("search").value.toLowerCase();
    let produtos = document.getElementsByClassName("product");
    for (let i = 0; i < produtos.length; i++) {
        let nome = produtos[i].getElementsByTagName("h3")[0].innerText.toLowerCase();
        produtos[i].style.display = nome.includes(texto) ? "block" : "none";
    }
}

/* ===== LOGIN ===== */
function abrirLogin() {
    document.getElementById("loginBox").style.display = "block";
    document.getElementById("overlay").style.display = "block";
}

function fecharLogin() {
    document.getElementById("loginBox").style.display = "none";
    document.getElementById("overlay").style.display = "none";
}

function login() {
    let nome = document.getElementById("nome").value;
    let email = document.querySelector("#loginBox input[type=email]").value;
    let senha = document.querySelector("#loginBox input[type=password]").value;

    if (!nome || !email || !senha) {
        alert("Preencha todos os campos!");
        return;
    }

    usuarioLogado = { nome, email };
    localStorage.setItem("usuario", JSON.stringify(usuarioLogado));

    document.getElementById("userArea").innerHTML = `
        <span>OlÃ¡, ${nome}</span>
        <button onclick="abrirCarrinho()">ðŸ›’ Carrinho (<span id="qtdCarrinho">${carrinho.length}</span>)</button>
    `;

    fecharLogin();
}

/* ===== CARRINHO ===== */
function comprar(produto) {
    if (!usuarioLogado) {
        alert("VocÃª precisa estar logado para comprar!");
        abrirLogin();
        return;
    }

    carrinho.push(produto);
    atualizarCarrinho();
    alert(`"${produto}" foi adicionado ao carrinho! ðŸ›’`);
}

function atualizarCarrinho() {
    document.getElementById("qtdCarrinho").innerText = carrinho.length;

    let lista = document.getElementById("listaCarrinho");
    lista.innerHTML = "";

    carrinho.forEach((item, index) => {
        let li = document.createElement("li");
        li.innerText = item;
        lista.appendChild(li);
    });
}

function abrirCarrinho() {
    document.getElementById("carrinhoBox").style.display = "block";
    document.getElementById("overlay").style.display = "block";
}

function fecharCarrinho() {
    document.getElementById("carrinhoBox").style.display = "none";
    document.getElementById("overlay").style.display = "none";
}

/* ===== AUTO LOGIN ===== */
if (usuarioLogado) {
    document.getElementById("userArea").innerHTML = `
        <span>OlÃ¡, ${usuarioLogado.nome}</span>
        <button onclick="abrirCarrinho()">ðŸ›’ Carrinho (<span id="qtdCarrinho">0</span>)</button>
    `;
}
</script>
